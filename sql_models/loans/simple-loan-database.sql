
/*
create schema if not exists loans;
use loans;
*/

drop table if exists balances;
drop table if exists loans;
drop table if exists customer_relationships;
drop table if exists customers;


create table customers (
    customer_id text not null primary key,
    customer_type text not null check (
        customer_type in ('Business', 'Individual', 'Lending Group')
    )
);

create table customer_relationships (
    parent_customer_id text not null,
    child_customer_id text not null,
    /* "`child_customer_id` is a `relationship_type` of `parent_customer_id`" */
    relationship_type text not null check (
        relationship_type in ('Subsidiary', 'Director')
    ),

    primary key (parent_customer_id, child_customer_id),
    foreign key (parent_customer_id) references customers(customer_id),
    foreign key (child_customer_id) references customers(customer_id)
);

create table loans (
    loan_id text not null primary key,
    loan_value real not null check (loan_value > 0),
    customer_id text not null references customers(customer_id)
);

/* This is purposefully missing some utility columns and indexes */
create table balances (
    loan_id text not null,
    balance_date date not null,
    balance real not null,

    primary key (loan_id, balance_date),
    foreign key (loan_id) references loans(loan_id)
);


------------------------------------------------------------------------
------------------------------------------------------------------------

insert into customers (customer_id, customer_type)
values
    ('BUS116595', 'Business'),
    ('BUS154890', 'Business'),
    ('BUS156044', 'Business'),
    ('BUS156544', 'Business'),
    ('BUS156548', 'Business'),
    ('BUS216549', 'Business'),
    ('BUS364265', 'Business'),
    ('BUS365265', 'Business'),
    ('BUS484532', 'Business'),
    ('BUS520654', 'Business'),
    ('BUS755902', 'Business'),
    ('IND154203', 'Individual'),
    ('IND450298', 'Individual'),
    ('IND454498', 'Individual'),
    ('IND459324', 'Individual'),
    ('IND549804', 'Individual'),
    ('IND744689', 'Individual'),
    ('IND752136', 'Individual'),
    ('IND986597', 'Individual'),
    ('IND996597', 'Individual'),
    ('LEN559852', 'Lending Group')
;


insert into customer_relationships (parent_customer_id, child_customer_id, relationship_type)
values
    ('LEN559852', 'BUS484532', 'Subsidiary'),
    ('LEN559852', 'BUS154890', 'Subsidiary'),
    ('BUS484532', 'BUS755902', 'Subsidiary'),
    ('BUS484532', 'BUS116595', 'Subsidiary'),
    ('BUS484532', 'IND744689', 'Director'),
    ('BUS154890', 'BUS365265', 'Subsidiary'),
    ('BUS154890', 'BUS156544', 'Subsidiary'),
    ('BUS755902', 'IND459324', 'Director'),
    ('BUS755902', 'IND752136', 'Director'),
    ('BUS755902', 'IND744689', 'Director'),
    ('BUS116595', 'IND744689', 'Director'),
    ('BUS365265', 'IND986597', 'Director'),
    ('BUS365265', 'IND454498', 'Director'),
    ('BUS156544', 'IND454498', 'Director'),
    ('BUS520654', 'BUS156548', 'Subsidiary'),
    ('BUS520654', 'BUS216549', 'Subsidiary'),
    ('BUS156548', 'IND154203', 'Director'),
    ('BUS156548', 'IND549804', 'Director'),
    ('BUS216549', 'IND549804', 'Director'),
    ('BUS364265', 'IND996597', 'Director'),
    ('BUS364265', 'IND450298', 'Director'),
    ('BUS156044', 'IND450298', 'Director')
;


insert into loans (loan_id, loan_value, customer_id)
values
    ('LOA123046', 26000, 'BUS154890'),
    ('LOA156487', 113000, 'BUS154890'),
    ('LOA156489', 91000, 'BUS156548'),
    ('LOA326984', 103000, 'BUS755902'),
    ('LOA447741', 210000, 'BUS755902'),
    ('LOA549321', 229000, 'BUS154890'),
    ('LOA655489', 27000, 'BUS484532'),
    ('LOA989215', 189000, 'IND454498')
;


insert into balances (loan_id, balance_date, balance)
values
    ('LOA123046', '2020-01-03', 26000),
    ('LOA156487', '2020-01-16', 113000),
    ('LOA156489', '2020-01-31', 91000),
    ('LOA123046', '2020-02-03', 24375),
    ('LOA326984', '2020-02-07', 103000),
    ('LOA156489', '2020-02-14', 86000),
    ('LOA156487', '2020-02-17', 103000),
    ('LOA447741', '2020-02-17', 210000),
    ('LOA156489', '2020-02-28', 81000),
    ('LOA123046', '2020-03-03', 22750),
    ('LOA156489', '2020-03-13', 76000),
    ('LOA156487', '2020-03-16', 93000),
    ('LOA156489', '2020-03-27', 71000),
    ('LOA123046', '2020-04-03', 21125),
    ('LOA156489', '2020-04-10', 66000),
    ('LOA156487', '2020-04-16', 83000),
    ('LOA156489', '2020-04-24', 61000),
    ('LOA123046', '2020-05-04', 19500),
    ('LOA326984', '2020-05-07', 78000),
    ('LOA156489', '2020-05-08', 56000),
    ('LOA156487', '2020-05-18', 73000),
    ('LOA156489', '2020-05-22', 51000),
    ('LOA123046', '2020-06-03', 17875),
    ('LOA156489', '2020-06-05', 46000),
    ('LOA156487', '2020-06-16', 63000),
    ('LOA156489', '2020-06-19', 41000),
    ('LOA123046', '2020-07-03', 16250),
    ('LOA156489', '2020-07-03', 36000),
    ('LOA156487', '2020-07-16', 53000),
    ('LOA156489', '2020-07-17', 31000),
    ('LOA156489', '2020-07-31', 26000),
    ('LOA123046', '2020-08-03', 14625),
    ('LOA326984', '2020-08-07', 53000),
    ('LOA156489', '2020-08-14', 21000),
    ('LOA156487', '2020-08-17', 43000),
    ('LOA447741', '2020-08-17', 205000),
    ('LOA447741', '2020-08-24', 200000),
    ('LOA156489', '2020-08-28', 16000),
    ('LOA447741', '2020-08-31', 195000),
    ('LOA123046', '2020-09-03', 13000),
    ('LOA447741', '2020-09-07', 190000),
    ('LOA156489', '2020-09-11', 11000),
    ('LOA447741', '2020-09-14', 185000),
    ('LOA156487', '2020-09-16', 33000),
    ('LOA447741', '2020-09-21', 180000),
    ('LOA156489', '2020-09-25', 6000),
    ('LOA447741', '2020-09-28', 175000),
    ('LOA123046', '2020-10-05', 11375),
    ('LOA447741', '2020-10-05', 170000),
    ('LOA156489', '2020-10-09', 0),
    ('LOA447741', '2020-10-12', 165000),
    ('LOA156487', '2020-10-16', 23000),
    ('LOA447741', '2020-10-19', 160000),
    ('LOA447741', '2020-10-26', 155000),
    ('LOA447741', '2020-11-02', 150000),
    ('LOA123046', '2020-11-03', 9750),
    ('LOA326984', '2020-11-09', 28000),
    ('LOA447741', '2020-11-09', 145000),
    ('LOA156487', '2020-11-16', 13000),
    ('LOA447741', '2020-11-16', 140000),
    ('LOA447741', '2020-11-23', 135000),
    ('LOA447741', '2020-11-30', 130000),
    ('LOA123046', '2020-12-03', 8125),
    ('LOA447741', '2020-12-07', 125000),
    ('LOA447741', '2020-12-14', 120000),
    ('LOA156487', '2020-12-16', 0),
    ('LOA447741', '2020-12-21', 115000),
    ('LOA447741', '2020-12-28', 110000),
    ('LOA123046', '2021-01-04', 6500),
    ('LOA447741', '2021-01-04', 105000),
    ('LOA447741', '2021-01-11', 100000),
    ('LOA447741', '2021-01-18', 95000),
    ('LOA447741', '2021-01-25', 90000),
    ('LOA447741', '2021-02-01', 85000),
    ('LOA123046', '2021-02-03', 4875),
    ('LOA326984', '2021-02-08', 0),
    ('LOA447741', '2021-02-08', 80000),
    ('LOA447741', '2021-02-15', 75000),
    ('LOA549321', '2021-02-16', 229000),
    ('LOA447741', '2021-02-22', 70000),
    ('LOA447741', '2021-03-01', 65000),
    ('LOA655489', '2021-03-02', 27000),
    ('LOA989215', '2021-03-02', 189000),
    ('LOA123046', '2021-03-03', 3250),
    ('LOA447741', '2021-03-08', 60000),
    ('LOA447741', '2021-03-15', 55000),
    ('LOA549321', '2021-03-16', 216500),
    ('LOA447741', '2021-03-22', 50000),
    ('LOA447741', '2021-03-29', 45000),
    ('LOA655489', '2021-04-02', 24750),
    ('LOA123046', '2021-04-05', 1625),
    ('LOA447741', '2021-04-05', 40000),
    ('LOA447741', '2021-04-12', 35000),
    ('LOA549321', '2021-04-16', 204000),
    ('LOA447741', '2021-04-19', 30000),
    ('LOA447741', '2021-04-26', 25000),
    ('LOA123046', '2021-05-03', 0),
    ('LOA447741', '2021-05-03', 20000),
    ('LOA655489', '2021-05-03', 22500),
    ('LOA989215', '2021-05-03', 173250),
    ('LOA447741', '2021-05-10', 15000),
    ('LOA447741', '2021-05-17', 10000),
    ('LOA549321', '2021-05-17', 191500),
    ('LOA447741', '2021-05-24', 5000),
    ('LOA447741', '2021-05-31', 0),
    ('LOA655489', '2021-06-02', 20250),
    ('LOA549321', '2021-06-16', 179000),
    ('LOA655489', '2021-07-02', 18000),
    ('LOA989215', '2021-07-02', 157500),
    ('LOA549321', '2021-07-16', 166500),
    ('LOA655489', '2021-08-02', 15750),
    ('LOA549321', '2021-08-16', 154000),
    ('LOA655489', '2021-09-02', 13500),
    ('LOA989215', '2021-09-02', 141750),
    ('LOA549321', '2021-09-16', 141500),
    ('LOA655489', '2021-10-04', 11250),
    ('LOA549321', '2021-10-18', 129000),
    ('LOA655489', '2021-11-02', 9000),
    ('LOA989215', '2021-11-02', 126000),
    ('LOA549321', '2021-11-16', 116500),
    ('LOA655489', '2021-12-02', 6750),
    ('LOA549321', '2021-12-16', 104000),
    ('LOA655489', '2022-01-03', 4500),
    ('LOA989215', '2022-01-03', 110250),
    ('LOA549321', '2022-01-17', 91500),
    ('LOA655489', '2022-02-02', 2250),
    ('LOA549321', '2022-02-16', 79000),
    ('LOA655489', '2022-03-02', 0),
    ('LOA989215', '2022-03-02', 94500),
    ('LOA549321', '2022-03-16', 66500),
    ('LOA549321', '2022-04-18', 54000),
    ('LOA989215', '2022-05-02', 78750),
    ('LOA549321', '2022-05-16', 41500),
    ('LOA549321', '2022-06-16', 29000),
    ('LOA989215', '2022-07-04', 63000),
    ('LOA549321', '2022-07-18', 16500),
    ('LOA549321', '2022-08-16', 0),
    ('LOA989215', '2022-09-02', 47250),
    ('LOA989215', '2022-11-02', 31500),
    ('LOA989215', '2023-01-02', 15750),
    ('LOA989215', '2023-03-02', 0)
;
